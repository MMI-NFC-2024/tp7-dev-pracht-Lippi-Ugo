---
import Layout from "../layouts/Layout.astro";
import populationMain from "../assets/detail_population.json";
import * as Plot from "@observablehq/plot";
import PlotFigure from "../components/PlotFigure.astro";
import departements from "../assets/departements.geojson.json";

let selectedYear = 2021;
let selectedSex = "Total";
let selectedAge = "Total";
const optionPlot = {
  projection: {
    type: "mercator", //utiliser une projection adaptée
    domain: departements, // Domain pour centrer la carte sur la france
  },
  color: {
    type: "quantile",
    n: 8,
    scheme: "Greens",
    label: "Population en centaine de milliers",
    legend: true,
    transform: (d) => Math.round(d / 100000),
  },
  marks: [
    Plot.geo(departements, {
      fill: (d) => {
        const deptName = d.properties.nom; //Nom du département dans le geoJson
        const popData = populationMain.find(
          (p) =>
            p.Géographie === deptName &&
            p.Période === selectedYear &&
            p.Sexe === selectedSex &&
            p["Âge"] === selectedAge
        ); //trouver les données correspondantes
        return popData.Valeur; //Coloriser en fonction de la valeur
      },
      stroke: "#999",
      title: (d) => {
        const deptName = d.properties.nom; //Nom du département dans le geoJson
        const popData = populationMain.find(
          (p) =>
            p.Géographie === deptName &&
            p.Période === selectedYear &&
            p.Sexe === selectedSex &&
            p["Âge"] === selectedAge
        ); //trouver les données correspondantes
        return `${deptName} : ${popData.Valeur}`; //Coloriser en fonction de la valeur
      },
      tip: true,
    }),
  ],
};
---

<Layout>
    <PlotFigure options={optionPlot} />
</Layout>